<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Automation</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/print.css" media="print">
    <!-- PDF Export Library with fallback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" onerror="loadHtml2pdfFallback()"></script>
    <script>
        function loadHtml2pdfFallback() {
            // Fallback CDN
            const fallbackScript = document.createElement('script');
            fallbackScript.src = 'https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js';
            fallbackScript.onerror = function() {
                console.warn('html2pdf library failed to load from both CDNs. PDF export will use print fallback.');
            };
            document.head.appendChild(fallbackScript);
        }
    </script>
</head>
<body>
    <div id="app">
        <!-- Navigation Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <img src="assets/logo.svg" alt="Invoice Automation" class="logo-img">
                        <h1 class="logo-text">Invoice Automation</h1>
                    </div>
                    <nav class="nav">
                        <button class="nav-btn" data-view="dashboard">Dashboard</button>
                        <button class="nav-btn" data-view="builder">New Invoice</button>
                        <button class="nav-btn" data-view="clients">Clients</button>
                        <button class="nav-btn" data-view="settings">Settings</button>
                        <button class="nav-btn" id="database-btn">üóÑÔ∏è Database</button>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard View -->
            <section id="dashboard-view" class="view">
                <div class="container">
                    <div class="view-header">
                        <h2>Dashboard</h2>
                        <div class="view-actions">
                            <button class="btn btn-outline" id="import-json-btn">Import JSON</button>
                            <button class="btn btn-outline" id="export-json-btn">Export JSON</button>
                            <button class="btn btn-primary" data-view="builder">New Invoice</button>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="kpi-grid">
                        <div class="card kpi-card">
                            <div class="kpi-value" id="total-invoices">0</div>
                            <div class="kpi-label">Total Invoices</div>
                        </div>
                        <div class="card kpi-card">
                            <div class="kpi-value" id="unpaid-invoices">0</div>
                            <div class="kpi-label">Unpaid</div>
                        </div>
                        <div class="card kpi-card">
                            <div class="kpi-value" id="overdue-invoices">0</div>
                            <div class="kpi-label">Overdue</div>
                        </div>
                        <div class="card kpi-card">
                            <div class="kpi-value" id="collected-month">‚Ç±0</div>
                            <div class="kpi-label">Collected This Month</div>
                        </div>
                    </div>

                    <!-- Invoice List -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Invoices</h3>
                            <div class="search-box">
                                <input type="text" id="invoice-search" placeholder="Search invoices...">
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="invoices-table">
                                <thead>
                                    <tr>
                                        <th data-sort="id">Invoice #</th>
                                        <th data-sort="client">Client</th>
                                        <th data-sort="issueDate">Date</th>
                                        <th data-sort="dueDate">Due Date</th>
                                        <th data-sort="total">Amount</th>
                                        <th data-sort="status">Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="invoices-tbody">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                            <div class="empty-state" id="invoices-empty">
                                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10,9 9,9 8,9"></polyline>
                                </svg>
                                <h3>No invoices yet</h3>
                                <p>Create your first invoice to get started</p>
                                <button class="btn btn-primary" data-view="builder">Create Invoice</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Invoice Builder View -->
            <section id="builder-view" class="view">
                <div class="container">
                    <div class="view-header">
                        <h2>Invoice Builder</h2>
                        <div class="view-actions">
                            <button class="btn btn-outline" id="duplicate-invoice-btn">Duplicate</button>
                            <button class="btn btn-outline" id="export-pdf-btn">Export PDF</button>
                            <div class="btn-group">
                                <button class="btn btn-secondary" id="send-email-btn">üìß Send Email</button>
                                <button class="btn btn-secondary dropdown-toggle" id="email-options-btn" aria-label="Email options">‚ñº</button>
                                <div class="dropdown-menu" id="email-dropdown">
                                    <button class="dropdown-item featured" id="setup-real-email-btn">üöÄ Setup Gmail API</button>
                                    <hr class="dropdown-divider">
                                    <button class="dropdown-item" id="send-gmail-btn">üì¨ Send via Gmail</button>
                                    <button class="dropdown-item" id="send-attachment-btn">üìé Send with PDF</button>
                                    <button class="dropdown-item" id="copy-email-btn">üìã Copy Email Content</button>
                                    <button class="dropdown-item" id="share-social-btn">üì± Social Share</button>
                                    <button class="dropdown-item" id="send-reminder-btn">‚è∞ Payment Reminder</button>
                                    <hr class="dropdown-divider">
                                    <button class="dropdown-item" id="email-setup-btn">‚öôÔ∏è Email Setup Guide</button>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="save-invoice-btn">Save Invoice</button>
                        </div>
                    </div>

                    <div class="builder-layout">
                        <!-- Invoice Form -->
                        <div class="builder-form">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Invoice Details</h3>
                                    <div class="auto-save-indicator" id="auto-save-status">
                                        <span class="status-text">Draft saved</span>
                                    </div>
                                </div>
                                
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="invoice-number">Invoice Number</label>
                                        <input type="text" id="invoice-number" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="issue-date">Issue Date</label>
                                        <input type="date" id="issue-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="due-date">Due Date</label>
                                        <input type="date" id="due-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="payment-terms">Payment Terms</label>
                                        <select id="payment-terms">
                                            <option value="Net 7">Net 7</option>
                                            <option value="Net 15">Net 15</option>
                                            <option value="Net 30" selected>Net 30</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Client Selection -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>Client</h3>
                                    <button class="btn btn-outline btn-sm" id="add-client-btn">Add New Client</button>
                                </div>
                                
                                <div class="form-group">
                                    <label for="client-select">Select Client</label>
                                    <select id="client-select">
                                        <option value="">Select a client...</option>
                                    </select>
                                </div>

                                <div id="client-details" class="client-preview">
                                    <!-- Dynamic client details -->
                                </div>
                            </div>

                            <!-- Line Items -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>Line Items</h3>
                                    <button class="btn btn-outline btn-sm" id="add-item-btn">Add Item</button>
                                </div>
                                
                                <div class="items-container" id="line-items">
                                    <!-- Dynamic line items -->
                                </div>
                            </div>

                            <!-- Additional Details -->
                            <div class="card">
                                <div class="card-header">
                                    <h3>Additional Details</h3>
                                </div>
                                
                                <div class="form-group">
                                    <label for="shipping-cost">Shipping Cost</label>
                                    <input type="number" id="shipping-cost" min="0" step="0.01" value="0">
                                </div>

                                <div class="form-group">
                                    <label for="invoice-notes">Notes</label>
                                    <textarea id="invoice-notes" rows="3" placeholder="Thank you for your business!"></textarea>
                                </div>

                                <!-- Recurring Settings -->
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="recurring-enabled"> Make this a recurring invoice
                                    </label>
                                </div>

                                <div id="recurring-options" class="recurring-settings" style="display: none;">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="recurring-interval">Interval</label>
                                            <select id="recurring-interval">
                                                <option value="weekly">Weekly</option>
                                                <option value="monthly" selected>Monthly</option>
                                                <option value="quarterly">Quarterly</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="next-run-date">Next Run Date</label>
                                            <input type="date" id="next-run-date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Live Preview -->
                        <div class="builder-preview">
                            <div class="card preview-card">
                                <div class="card-header">
                                    <h3>Live Preview</h3>
                                </div>
                                <div id="invoice-preview" class="invoice-preview">
                                    <!-- Dynamic invoice preview -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Clients View -->
            <section id="clients-view" class="view">
                <div class="container">
                    <div class="view-header">
                        <h2>Clients</h2>
                        <div class="view-actions">
                            <button class="btn btn-primary" id="new-client-btn">Add Client</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Client List</h3>
                            <div class="search-box">
                                <input type="text" id="client-search" placeholder="Search clients...">
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="clients-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Company</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="clients-tbody">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                            <div class="empty-state" id="clients-empty">
                                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <h3>No clients yet</h3>
                                <p>Add your first client to get started</p>
                                <button class="btn btn-primary" id="add-first-client-btn">Add Client</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="settings-view" class="view">
                <div class="container">
                    <div class="view-header">
                        <h2>Settings</h2>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Company Information</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="company-name">Company Name</label>
                                <input type="text" id="company-name" placeholder="Your Company Name">
                            </div>
                            <div class="form-group">
                                <label for="company-email">Company Email</label>
                                <input type="email" id="company-email" placeholder="info@yourcompany.com">
                            </div>
                            <div class="form-group">
                                <label for="company-phone">Company Phone</label>
                                <input type="tel" id="company-phone" placeholder="+1 (555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label for="company-address">Company Address</label>
                                <textarea id="company-address" placeholder="123 Business St&#10;City, State 12345" rows="3"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Invoice Settings</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="invoice-prefix">Invoice Prefix</label>
                                <input type="text" id="invoice-prefix" placeholder="INV">
                            </div>
                            <div class="form-group">
                                <label for="currency">Currency</label>
                                <select id="currency">
                                    <option value="PHP" selected>PHP (‚Ç±)</option>
                                    <option value="USD">USD ($)</option>
                                    <option value="EUR">EUR (‚Ç¨)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="number-seed">Invoice Number Seed</label>
                                <input type="number" id="number-seed" min="1">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" id="save-settings-btn">Save Settings</button>
                            <button class="btn btn-outline" id="reset-seed-btn">Reset Number Seed</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="modal" role="dialog" aria-labelledby="client-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="client-modal-title">Add Client</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <form id="client-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="client-name">Name *</label>
                        <input type="text" id="client-name" required>
                    </div>
                    <div class="form-group">
                        <label for="client-company">Company</label>
                        <input type="text" id="client-company">
                    </div>
                    <div class="form-group">
                        <label for="client-email">Email</label>
                        <input type="email" id="client-email">
                    </div>
                    <div class="form-group">
                        <label for="client-phone">Phone</label>
                        <input type="tel" id="client-phone">
                    </div>
                    <div class="form-group">
                        <label for="client-address">Address</label>
                        <textarea id="client-address" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="client-tax-id">VAT/TIN</label>
                        <input type="text" id="client-tax-id">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline modal-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- File Input for JSON Import -->
    <input type="file" id="json-file-input" accept=".json" style="display: none;">

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="js/app.js" type="module"></script>
</body>
</html>
